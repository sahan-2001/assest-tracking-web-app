<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebGIS Asset Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.css">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }
        h1 {
            text-align: center;
            margin: 10px;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 90vh;
        }
    </style>
</head>
<body>
    <h1>üõ∞Ô∏è Asset Tracking Map</h1>
    <div id="map"></div>

    <script src="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.js"></script>
    <script>
        // Initialize the map
        const map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([79.88, 6.90]),
                zoom: 10
            })
        });

        // Create a vector layer for assets
        const vectorSource = new ol.source.Vector();
        const vectorLayer = new ol.layer.Vector({
            source: vectorSource,
            style: new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 7,
                    fill: new ol.style.Fill({ color: 'red' }),
                    stroke: new ol.style.Stroke({ color: '#fff', width: 2 })
                })
            })
        });
        map.addLayer(vectorLayer);

        // Function to load and update assets
        function updateAssets() {
            fetch('/api/assets')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    const features = new ol.format.GeoJSON().readFeatures(data, {
                        featureProjection: 'EPSG:3857'
                    });
                    vectorSource.clear();
                    vectorSource.addFeatures(features);
                })
                .catch(error => {
                    console.error('Error loading assets:', error);
                });
        }

        // Load assets immediately and then every 10 seconds
        updateAssets();
        setInterval(updateAssets, 10000);
    </script>
</body>
</html>